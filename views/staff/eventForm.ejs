<!-- views/admin/users.ejs -->
<% include ../../partials/header %>
<!--<script src='/public/bgrins-spectrum/spectrum.js'></script>
<link rel='stylesheet' href='/public/bgrins-spectrum/spectrum.css' />-->
<style>
textarea {
	width: 100%;
	height: 100px;
	resize: none;
}
.dotted {
	border-top: 2px dotted;
	width: 80%;
	color: #c9b66f;
}

.itemTable th,
.itemTable td {
	-webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  padding: 12px 0px 12px 10px;
}

.itemTable	th {
	background-color: #83052b;
  color: #f2ebd0;
  font-size: 1.2em;
}

.itemTable {
	margin-top: 5px;
}

.remove-item-btn	{
	width: 30px;
	height: 30px;
}

.itemTable tbody tr:nth-child(even) {
	background-color: #D9D2B7;
}
</style>
<% getPrices(flowers); %>

	<div class="page-header text-center">
		<h1><span class="fa fa-calendar"></span> Event Form</h1>
	</div>

  <form action="/staff/eventForm" method="post">
		<h2>Customer & General Info</h2>
		<div class="row">
			<div class="form-group col-sm-4">
				<label>Customer</label>
				<select class="form-control" name="customer">
					<% printCustomers(customers); %>
				</select>
			</div>
			<div class="form-group col-sm-4">
				<label>Bride's Name</label>
				<input type="text" class="form-control" name="brides-name">
			</div>
			<div class="form-group col-sm-4">
				<label>Groom's Name</label>
				<input type="text" class="form-control" name="grooms-name">
			</div>
		</div>
		<!--
		<div class="row">
			<div class="form-group col-sm-4">
				<label>Email</label>
				<input type="text" class="form-control" name="email">
			</div>
			<div class="form-group col-sm-4">
				<label>Phone</label>
				<input type="text" class="form-control" name="phone">
			</div>
		</div>
		<div class="row">
			<div class="form-group col-sm-12">
				<label>Address</label>
				<input type="text" class="form-control" name="address">
			</div>
		</div>
		<div class="row">
			<div class="form-group col-sm-4">
				<label>City</label>
				<input type="text" class="form-control" name="city">
			</div>
			<div class="form-group col-sm-4">
				<label>State</label>
				<input type="text" class="form-control" name="state">
			</div>
			<div class="form-group col-sm-4">
				<label>Zip</label>
				<input type="text" class="form-control" name="zip">
			</div>
		</div> -->

		<hr>

		<h2>Ceremony Info</h2>
		<div class="row">
			<div class="form-group col-sm-6">
					<label>Date</label>
					<input type="text" class="form-control date" name="ceremony-date">
			</div>
			<div class="form-group col-sm-6">
				<label>Start Time</label>
				<select class="form-control" name="ceremony-start-time">
					<% printTimes(); %>
				</select>
			</div>
		</div>
		<div class="row">
			<div class="form-group col-sm-3">
				<label>Address</label>
				<input type="text" class="form-control" name="ceremony-address">
			</div>
			<div class="form-group col-sm-3">
				<label>City</label>
				<input type="text" class="form-control" name="ceremony-city">
			</div>
			<div class="form-group col-sm-3">
				<label>State</label>
				<input type="text" class="form-control" name="ceremony-state">
			</div>
			<div class="form-group col-sm-3">
				<label>Zip</label>
				<input type="text" class="form-control" name="ceremony-zip">
			</div>
		</div>
		<div class="row">
			<div class="form-group col-sm-6">
				<label>Colors</label><br>
				<textarea name="color-notes"></textarea>
			</div>
			<div class="form-group col-sm-6">
				<label>Theme</label><br>
				<textarea name="theme-notes"></textarea>
			</div>
		</div>

		<hr>
		<!-- RECEPTION -->

		<h2>Reception Info</h2>
		<div class="row">
			<div class="form-group col-sm-6">
					<label>Date</label>
					<input type="text" class="form-control date" name="reception-date">
			</div>
			<div class="form-group col-sm-6">
				<label>Start Time</label>
				<select class="form-control" name="reception-start-time">
					<% printTimes(); %>
				</select>
			</div>
		</div>
		<div class="row">
			<div class="form-group col-sm-3">
				<label>Address</label>
				<input type="text" class="form-control" name="reception-address">
			</div>
			<div class="form-group col-sm-3">
				<label>City</label>
				<input type="text" class="form-control" name="reception-city">
			</div>
			<div class="form-group col-sm-3">
				<label>State</label>
				<input type="text" class="form-control" name="reception-state">
			</div>
			<div class="form-group col-sm-3">
				<label>Zip</label>
				<input type="text" class="form-control" name="reception-zip">
			</div>
		</div>

<hr>
<h2>Photography, Planner, & Delivery</h2>
<div class="row">
	<div class="form-group col-sm-6">
		<label>Photographers</label>
		<input type="text" class="form-control" name="photographers">
	</div>
	<div class="form-group col-sm-6">
		<label>Photography Start Time</label>
		<select class="form-control" name="photograph-start-time">
			<% printTimes(); %>
		</select>
	</div>
</div>
<div class="row">
	<div class="form-group col-sm-6">
		<label>Wedding Planner</label>
		<input type="text" class="form-control" name="wedding-planner">
	</div>
	<div class="form-group col-sm-6">
		<label>Delivery Time</label>
		<select class="form-control" name="delivery-time">
			<% printTimes(); %>
		</select>
	</div>
</div>

		<hr>

		<h2>Bouquets</h2>
		<!-- Bridal -->
		<div class="row">
			<div class="form-group col-sm-6">
				<label>Bridal</label>
				<br>

				<input type="button" class='add-btn btn btn-primary' id="add-bouquet-bridal" value="Add" />
				<table class="itemTable" id="bouquet-bridal-table" cellspacing="0" width="100%">
					<thead>
						<th>Item</th>
						<th>Quantity</th>
						<th>Price (each)</th>
						<th>Remove</th>
					</thead>
					<tbody>
					<tr>
						<td class='item' id='bouquet-bridal-item'><b>Total<b></td>
						<td class='qty' id='bouquet-bridal-qty'></td>
						<td class='price' id='bouquet-bridal-price'><b>$0.00<b></td>
						<td class='remove' id='bouquet-bridal-remove'></td>
					</tr>
				</tbody>
				</table>
			</div>
			<div class="form-group col-sm-6">
				<label>Qty</label>
				<input type="number" min="0" class="form-control" name="bridal-bouquet-qty">
			</div>
			<div class="form-group col-sm-6">
				<label>Notes</label>
				<textarea name="reception-notes"></textarea>
			</div>
		</div>

		<hr class="dotted">

		<div class="row">
			<div class="form-group col-sm-6">
				<label>Bridesmaids</label><br>
				<br>

				<input type="button" class='add-btn btn btn-primary' id="add-bouquet-bridesmaids" value="Add" />
				<table class="itemTable" id="bouquet-bridesmaids-table" cellspacing="0" width="100%">
					<thead>
						<th>Item</th>
						<th>Quantity</th>
						<th>Price (each)</th>
						<th>Remove</th>
					</thead>
					<tbody>
					<tr>
						<td class='item' id='bouquet-bridesmaids-item'><b>Total<b></td>
						<td class='qty' id='bouquet-bridesmaids-qty'></td>
						<td class='price' id='bouquet-bridesmaids-price'><b>$0.00<b></td>
						<td class='remove' id='bouquet-bridesmaids-remove'></td>
					</tr>
				</tbody>
				</table>
			</div>
			<div class="form-group col-sm-6">
				<label>Qty</label>
				<input type="number" min="0" class="form-control" name="bridesmaids-bouquet-qty">
			</div>
			<div class="form-group col-sm-6">
				<label>Notes</label>
				<textarea name="reception-notes"></textarea>
			</div>
		</div>

		<hr>

		<h2>Boutonnieres</h2>
		<!-- Groom -->
		<div class="row">
			<div class="form-group col-sm-6">
				<label>Groom</label>
				<br>

				<input type="button" class='add-btn btn btn-primary' id="add-boutonniere-groom" value="Add" />
				<table class="itemTable" id="boutonniere-groom-table" cellspacing="0" width="100%">
					<thead>
						<th>Item</th>
						<th>Quantity</th>
						<th>Price (each)</th>
						<th>Remove</th>
					</thead>
					<tbody>
					<tr>
						<td class='item' id='boutonniere-groom-item'><b>Total<b></td>
						<td class='qty' id='boutonniere-groom-qty'></td>
						<td class='price' id='boutonniere-groom-price'><b>$0.00<b></td>
						<td class='remove' id='boutonniere-groom-remove'></td>
					</tr>
				</tbody>
				</table>
			</div>
			<div class="form-group col-sm-6">
				<label>Qty</label>
				<input type="number" min="0" class="form-control" name="groom-boutonniere-qty">
			</div>
			<div class="form-group col-sm-6">
				<label>Notes</label>
				<textarea name="reception-notes"></textarea>
			</div>
		</div>

		<hr class="dotted">

		<!-- Groomsmen -->
		<div class="row">
			<div class="form-group col-sm-6">
				<label>Groomsmen</label><br>
				<br>

				<input type="button" class='add-btn btn btn-primary' id="add-boutonniere-groomsmen" value="Add" />
				<table class="itemTable" id="boutonniere-groomsmen-table" cellspacing="0" width="100%">
					<thead>
						<th>Item</th>
						<th>Quantity</th>
						<th>Price (each)</th>
						<th>Remove</th>
					</thead>
					<tbody>
					<tr>
						<td class='item' id='boutonniere-groomsmen-item'><b>Total<b></td>
						<td class='qty' id='boutonniere-groomsmen-qty'></td>
						<td class='price' id='boutonniere-groomsmen-price'><b>$0.00<b></td>
						<td class='remove' id='boutonniere-groomsmen-remove'></td>
					</tr>
				</tbody>
				</table>
			</div>
			<div class="form-group col-sm-6">
				<label>Qty</label>
				<input type="number" min="0" class="form-control" name="groomsmen-boutonniere-qty">
			</div>
			<div class="form-group col-sm-6">
				<label>Notes</label>
				<textarea name="reception-notes"></textarea>
			</div>
		</div>

		<hr class="dotted">

		<!-- Ushers -->
		<div class="row">
			<div class="form-group col-sm-6">
				<label>Ushers</label><br>
				<br>

				<input type="button" class='add-btn btn btn-primary' id="add-boutonniere-ushers" value="Add" />
				<table class="itemTable" id="boutonniere-ushers-table" cellspacing="0" width="100%">
					<thead>
						<th>Item</th>
						<th>Quantity</th>
						<th>Price (each)</th>
						<th>Remove</th>
					</thead>
					<tbody>
					<tr>
						<td class='item' id='boutonniere-ushers-item'><b>Total<b></td>
						<td class='qty' id='boutonniere-ushers-qty'></td>
						<td class='price' id='boutonniere-ushers-price'><b>$0.00<b></td>
						<td class='remove' id='boutonniere-ushers-remove'></td>
					</tr>
				</tbody>
				</table>
			</div>
			<div class="form-group col-sm-6">
				<label>Qty</label>
				<input type="number" min="0" class="form-control" name="ushers-boutonniere-qty">
			</div>
			<div class="form-group col-sm-6">
				<label>Notes</label>
				<textarea name="reception-notes"></textarea>
			</div>
		</div>

		<hr>

		<h2>Corsages</h2>
		<div class="row">

			<!-- Groom Left -->
			<div class="form-group col-sm-4">
				<label>Groom</label>
				<select class="form-control" name="corsages-groom"><% printFlowers(flowers); %></select>
			</div>
			<!-- Groom Right -->
			<div class="form-group col-sm-4">
				<label>Groomsman #1</label>
				<select class="form-control" name="corsages-groomsman1"><% printFlowers(flowers); %></select>
			</div>
			<div class="form-group col-sm-4">
				<label>Groomsman #2</label>
				<select class="form-control" name="corsages-groomsman2"><% printFlowers(flowers); %></select>
			</div>
		</div>

		<hr>

		<h2>Ceremony Decorations</h2>
		<div class="row">
			<div class="form-group col-sm-4">
				<label>Groom</label>
				<select class="form-control" name="corsages-groom"><% printFlowers(flowers); %></select>
			</div>
			<div class="form-group col-sm-4">
				<label>Groomsman #1</label>
				<select class="form-control" name="corsages-groomsman1"><% printFlowers(flowers); %></select>
			</div>
			<div class="form-group col-sm-4">
				<label>Groomsman #2</label>
				<select class="form-control" name="corsages-groomsman2"><% printFlowers(flowers); %></select>
			</div>
		</div>

		<hr>

		<h2>Reception Decorations</h2>
		<div class="row">
			<div class="form-group col-sm-4">
				<label>Groom</label>
				<select class="form-control" name="corsages-groom"><% printFlowers(flowers); %></select>
			</div>
			<div class="form-group col-sm-4">
				<label>Groomsman #1</label>
				<select class="form-control" name="corsages-groomsman1"><% printFlowers(flowers); %></select>
			</div>
			<div class="form-group col-sm-4">
				<label>Groomsman #2</label>
				<select class="form-control" name="corsages-groomsman2"><% printFlowers(flowers); %></select>
			</div>
		</div>

		<hr>

		<!-- Add Item Modal -->
		<div class="container">

			<div class="modal fade" id="mdlAddItem" role="dialog">
				<div class="modal-dialog">

					<div class="modal-content">
						<div class="modal-header" style="padding:32px 32px;">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4>Add Item</h4>
						</div>
						<div class="modal-body" style="padding:48px 48px;">
							<form name="formEditInventory" role="form" attribute="">
								<div class="form-group">
									<input class="modal-hidden-table" id="modal-table-id" type="hidden" value="" />
									<label>Item</label>
									<select class="form-control" name="altar-flowers" id="altar-flowers" style="width: 200px; display: inline;"><% printFlowers(flowers); %></select>&nbsp;
									<label style="display: inline;">Quantity</label>&nbsp;
									<input name="addQuanitiy" id="addQuantity" type="number" min="1" step="1" style="width: 40px; display: inline;" />
									<label style="display: inline;">$ Price</label>&nbsp;
									<input name="addPrice" id="addPrice" style="width: 75; display: inline;" type="number" min="0" min="0.00" step="0.01" class="form-control";>
								</div>
								<br><br>
								<div>
									<button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal">Cancel</button>
									<button type="submit" class="btn btn-success btn-default pull-right" id="addItem">Add</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
  </form>

  <% include ../../partials/footer %>

<script>
$( document ).ready(function() {
	$(".date").datepicker();

	// Display "add inventory" modal.
	$(".add-btn").on('click', function() {
			var tblID = $(this).next('table').attr('id');
			$('#modal-table-id').val(tblID);
			$("#mdlAddItem").modal();
	});

	// Load price on item select
	$("#altar-flowers").on('change', function()	{
		if ($(this).prop('selectedIndex') != 0)	{
			var name = $("option:selected", this).text();
			var price = prices[name];
			$(this).siblings('#addPrice').val(price);
			$(this).siblings('#addQuantity').val(1);
		}
		else {
			$(this).siblings('#addPrice').val(price);
			$(this).siblings('#addQuantity').val(null);
		}
	});
});

	// Add new item to recipe table
	$("#addItem").on('click', function()	{
		if ($("#altar-flowers").prop("selectedIndex") != 0)	{
			event.preventDefault();

			var $form = $(this).closest('form');
			var item = $form.find('#altar-flowers option:selected').text();
			var qty = $form.find('#addQuantity').val();
			var price = $form.find('#addPrice').val();
			var tblID = $form.find('#modal-table-id').val();
			var tbl = $("#" + tblID);
			tbl.prepend("<tr><td>" + item + "</td><td style='text-align: right;'>" + qty + " x </td><td>$" + price + "</td><td><center><input type='button' class='remove-item-btn' value='x' /></ center></td></tr>");
			var qtyPrice = parseFloat(qty) * parseFloat(price);
			var tblTotal = tbl.find('.price');
			var initPrice = tblTotal.text();
			initPrice = initPrice.replace(/[,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
			totalToDisp = parseFloat(initPrice) + parseFloat(qtyPrice);
			tblTotal.html("<b>$" + totalToDisp.toFixed(2) + "</b>");
			$("#mdlAddItem").modal('hide');
		}
		else {
			event.preventDefault();
			alert("Please select a valid item.");
		}
	});

	// Remove item from recipe table
	$(document).on("click", ".remove-item-btn", function ()	{
		event.preventDefault();
		var parentTbl = $(this).closest('table');
		var rowClicked = $(this).closest('tr');
		var initQty = $(this).closest('td').prev('td').prev('td').text();
		initQty = initQty.substr(0, 1);
		initQty = parseFloat(initQty);
		var pricePerItem = $(this).closest('td').prev('td').text();
		pricePerItem = pricePerItem.replace(/[,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
		pricePerItem = parseFloat(pricePerItem);
		var currTblTotal = parentTbl.find('.price').text();
		currTblTotal = currTblTotal.replace(/[,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
		currTblTotal = parseFloat(currTblTotal);
		var newTotal = currTblTotal - pricePerItem;
		parentTbl.find('.price').html('<b>$' + newTotal.toFixed(2) + '</b>');
		if (initQty > 1)	{
			var newQty = initQty - 1;
			$(this).closest('td').prev('td').prev('td').text(newQty + ' x');
		}
		else {
			rowClicked.remove();
		}
	});

$(function() {

		/*<!-- enable spectrum color picker on color1-4 input fields -->
		$("#color1, #color2, #color3, #color4").spectrum({
		    color: "#ECC",
		    showInput: true,
		    className: "full-spectrum",
		    showInitial: true,
		    showPalette: true,
		    showSelectionPalette: true,
		    maxSelectionSize: 10,
		    preferredFormat: "hex",
		    localStorageKey: "spectrum.demo",
		    move: function (color) {

		    },
		    show: function () {

		    },
		    beforeShow: function () {

		    },
		    hide: function () {

		    },
		    change: function() {

		    },
		    palette: [
		        ["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)",
		        "rgb(204, 204, 204)", "rgb(217, 217, 217)","rgb(255, 255, 255)"],
		        ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
		        "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"],
		        ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)",
		        "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)",
		        "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)",
		        "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)",
		        "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)",
		        "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
		        "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
		        "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
		        "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)",
						"rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
		    ]
		});*/

});
</script>

<% function printTimes() { %>
	<% var minutes = ["00","15","30","45"]; %>
	<% for(var i = 0; i <=23; i++) { %>
		<% for(var j = 0; j < minutes.length; j++) {
			var suffix = (i >= 12)? 'pm' : 'am';
			var hours = (i > 12) ? i - 12 : i;
			if(hours == 0) {
				hours = 12;
			} %>
			<option value="<%= hours + minutes[j] + suffix %>"><%= hours + ":" + minutes[j] + " " + suffix%></option>
		<% } %>
	<% } %>
<% } %>

<% function printFlowers(flowers) { %>
	<option value="">Select Flower...</option>
	<% flowers.forEach(function(item, index) { %>
			<option value="<%= item.id %>"><%= item.name %></option>
	<% }); %>
<% } %>

<% function printCustomers(customers) { %>
	<% customers.forEach(function(item, index) { %>
			<option value="<%= item.id %>"><%= item.lastName + ', ' + item.firstName %></option>
	<% }); %>
<% } %>

<% function getPrices(flowers) { %>
	<script>
		var prices = {};
	</script>
	<% flowers.forEach(function(item, index) { %>
			<script>
				prices['<%= item.name %>'] = <%= item.price %>;
			</script>
	<% }); %>
<% } %>


<style>
div.ui-datepicker, .ui-datepicker td {
 	font-size:1.5em;
}
</style>

<!--
General information:
Date of wedding
Brides Name
Grooms Name
Email Address
Phone number(s)
Physical Address
Ceremony Location
Ceremony start time

Reception Location
Reception start time

Other
Photographer start time
Wedding Planner

Delivery time

Recipe Categories: (Recipe, pricing, design notes)
Bridal bouquet
Bridesmaids (total number=#)
Throw bouquet
Boutonnieres:
    Groom,
    Groomsmen (#)
    Ushers (#)
    Fathers (#)
    Grandfathers(#)
    Ring Bearers (#)
    Officiant
    Vocalist
    Hosts
    Reader
    Musician
Corsages:
    Mothers (#)
    Grandmothers(#)
    Guest Book (#)
    Cake Cutter(#)
    Reader
    Vocalist
    Hostess
    Musician
    Flower Girl (#)
Ceremony Decorations
    Altar (#)
    Aisle decorations
    Guest Book
    Candelabras
    Unity Candle
Reception Decorations
    Centerpieces (#) [**Often this category might have 1-4 different styles         so multiple entries will be needed for different recipes**]
    Head Table
    Bar Flowers
    Guest book
    Cake Flowers
    Other [**would like to be able to add a category should a bride be         doing something unique I can add that in easily**]
-->
