<!-- views/admin/users.ejs -->
<% include ../../partials/header %>

	<div class="page-header text-center">
		<h1><span class="fa fa-unlock"></span> Admin - Inventory</h1>
	</div>

	<div>
		<button class='addnewbtn btn btn-primary' id="btnAddInventory">Add New Inventory Item</button>
	</div>

	<table id="inventory" style="width: 100%">
		<thead>
			<th>ID</th>
			<th>Name</th>
			<th>Price</th>
			<th>Type</th>
			<th>Edit</th>
		</thead>
		<tbody>
		<% if(inventory) {
				inventory.forEach(function(item, index) { %>
					<tr>
						<!--<td class="itemName" contenteditable="True"><%= item.name %></td>-->
						<td class='itemId'><%= item.id %></td>
						<td class='itemName'><%= item.name %></td>
						<td class='itemPrice'><%= item.price %></td>
						<td class='itemType'><%= item.inventoryType %></td>
						<!--<td><input type="number" step="0.01" class="form-control itemPrice" value=<%= item.price %>></td>-->
						<td><button class='editbtn btn btn-primary' id="btnEditInventory">Edit</button></td>
					</tr>
				<% });
			}%>
		</tbody>
	</table>

	<!-- Add Inventory Modal -->
	<div class="container">

	  <div class="modal fade" id="mdlInventory" role="dialog">
	    <div class="modal-dialog">

	      <div class="modal-content">
	        <div class="modal-header" style="padding:32px 32px;">
	          <button type="button" class="close" data-dismiss="modal">&times;</button>
	          <h4>Edit Inventory Item</h4>
	        </div>
	        <div class="modal-body" style="padding:48px 48px;">
	          <form name="formEditInventory" role="form" attribute="">
	            <div class="form-group">
	              <label>Name</label>
	              <input name="mdlName" type="text" class="form-control" id="mdlName" placeholder="Enter name">
	            </div>
	            <div class="form-group">
	              <label>$ Price</label>
	              <input name="mdlPrice" type="number" min="0.00" step="0.01" class="form-control currency" id="mdlPrice" placeholder="Enter price">
	            </div>
							<div class="form-group">
	              <label>Inventory Type</label>
								<select name="mdlType" class="form-control" id="mdlType">
									<% printInventoryTypes(inventoryTypes); %>
								</select>
	            </div>
							<div class="form-group">
              	<input type="text" name="mdlID" id="mdlID" style="display:none">
            	</div>
							<br><br>
							<div>
			          <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal">Cancel</button>
								<button type="submit" class="btn btn-success btn-default pull-right" id="updateInventory">Update</button>
			        </div>
	          </form>
	        </div>
	      </div>
	    </div>
	  </div>
	</div>

<% include ../../partials/footer %>

<script>
$( document ).ready(function() {
    $("#inventory").DataTable({
    		"iDisplayLength": 50,
				"bPaginate": false
  	});

		// Display "add inventory" modal.
		$("#btnAddInventory").on('click', function() {
			$("#mdlName").val('');
			$("#mdlPrice").val('');
			$("#mdlType").val('');
			$("#mdlID").val('');
			$("#mdlInventory").modal();
		});

		// Display "edit inventory" modal
		$("#btnEditInventory").on('click', function() {
				var row = $(this).closest('tr');
				var id = row.find('.itemId').text();
				var name = row.find('.itemName').text();
				var price = row.find('.itemPrice').text();
				var type = getInventoryType(row.find('.itemType').text());

        $("#mdlInventory").modal();

			  $("#mdlName").val(name);
				$("#mdlPrice").val(price);
				$("#mdlType").val(type);
				$("#mdlID").val(id);
    });

		/*$(".itemName").on("blur", function() {
			alert("test");
		});*/

		function getInventoryType(type) {
			var inventoryTypes = <%- JSON.stringify(inventoryTypes) %>;
			var val = 0;
			inventoryTypes.forEach(function(item, index) {
				if(type == item.type) {
					val = item.id;
				}
			});
			return val;
		}

		$("#addInventory").on('click', function() {
			var $form = $(this).closest('form');
			event.preventDefault();
			// Display wait animation if needed.
			$.ajax({
				url: '/admin/inventory',
				data: $form.serialize(),
				method: 'POST',
				success: function(response) {
					response = JSON.parse(response);
					alert(response.message);
				}
			})
		});

		$("#updateInventory").on('click', function() {
			var $form = $(this).closest('form');
			event.preventDefault();
			// Display wait animation if needed.
			$.ajax({
				url: '/admin/inventory',
				data: $form.serialize(),
				method: 'POST',
				success: function(response) {
					response = JSON.parse(response);
					alert(response.message);
				}
			})
		});
});
</script>

<% function printInventoryTypes(inventoryTypes) { %>
	<% inventoryTypes.forEach(function(item, index) { %>
			<option value=<%= item.id %>><%= item.type %></option>
	<% });
} %>
